---
phase: 07-deployment-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/architecture/DEPLOYMENT_ARCHITECTURE.md
autonomous: true

must_haves:
  truths:
    - "The online deployment architecture specifies Hetzner topology (server types, network layout, load balancer config, scaling approach, HA strategy) with a concrete provisioning runbook"
    - "The offline Docker bundle specification includes the complete docker-compose.yml structure, image list, model weights, config files, install script, verify script, and export script"
  artifacts:
    - path: "docs/architecture/DEPLOYMENT_ARCHITECTURE.md"
      provides: "Online deployment + offline Docker bundle specification"
      min_lines: 600
---

<objective>
Create the deployment architecture document: (1) Online Hetzner topology with server types, network layout, Traefik load balancer, scaling, HA; (2) Concrete provisioning runbook; (3) Offline Docker bundle with docker-compose.yml structure, image list, model weights, config, install/verify/export scripts.

Output: `docs/architecture/DEPLOYMENT_ARCHITECTURE.md`
</objective>

<context>
@docs/architecture/TENANT_ISOLATION_HETZNER.md (provisioning, firewall, Docker offline equivalent)
@docs/architecture/STORAGE_LAYER_PLAN.md (MinIO, PostgreSQL, Qdrant, Redis)
@docs/architecture/FOUNDATION_LAYER_PLAN.md (Docker skeleton, migrations)
@docs/reference/TECH_DECISIONS.md (Section 2 online manifest, Section 3 offline manifest)
</context>

<tasks>
<task type="auto">
  <name>Write deployment architecture</name>
  <files>docs/architecture/DEPLOYMENT_ARCHITECTURE.md</files>
  <action>
Create docs/architecture/DEPLOYMENT_ARCHITECTURE.md with: (1) Section 1 Online Topology — server types per role (gateway, worker, db), network layout (per TENANT_ISOLATION_HETZNER), Traefik config, scaling (per-tenant VM scale-out), HA (tenant failover); (2) Section 2 Provisioning Runbook — step sequence, API calls, verification; (3) Section 3 Offline Bundle — docker-compose.yml full structure (all services: intake, parse, policy, embed, serving, celery, postgres, minio, qdrant, redis, clamav, nomic), image list with digests, model weights list, config file layout, install.sh, verify.sh, export.sh, MANIFEST.json schema
  </action>
</task>
</tasks>

<output>
Create 07-01-SUMMARY.md
</output>
